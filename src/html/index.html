<!DOCTYPE html>
<html style="height:100%">

<head>
    <title>科盟科教</title>
    <script src="../../node_modules/blockly/blockly_compressed.js"></script>
    <script src="../../node_modules/blockly/blocks_compressed.js"></script>
    <script src="../../node_modules/blockly/python_compressed.js"></script>
    <script src="../../node_modules/blockly/msg/en.js"></script>
    <script src="../js/index.js"></script>
    <script> if (typeof module === 'object') { window.module = module; module = undefined; }</script>
    <script src="../js/jquery-1.11.0.min.js" type="text/javascript"></script>
    <script src="../js/jquery-linedtextarea.js"></script>
    <script> if (window.module) module = window.moudle;</script>
    <link rel="stylesheet" href="../css/index.css">
    <link href="../css/jquery-linedtextarea.css" type="text/css" rel="stylesheet" />
</head>

<body style="height:100%; overflow:hidden">

    <div class="menu-bar">
        <img src="../images/logo.svg" style="margin-left: 15px; margin-right: 15px; width: 120px; height: 45px;" />
        <div class="menu-button" onclick="file()">
            <img src="../images/file.svg" />
            <span>文件</span>
        </div>
        <div class="menu-button" onclick="select()">
            <img src="../images/device.svg" />
            <span>选择设备</span>
        </div>
        <div class="menu-button" onclick="connect_device()">
            <img src="../images/connect.svg" />
            <span>连接设备</span>
        </div>
        <div class="menu-button" onclick="uploads()">
            <img src="../images/uploads.svg" />
            <span>上传</span>
        </div>
        <div class="menu-button" onclick="about()">
            <img src="../images/about.svg" />
            <span>关于</span>
        </div>
    </div>

    <div id="light" class="white_content" onclick="select_device()">
        <div id="9028b" class="device-message">
            <img src="../images/9016.jpg" />
            <span>9028b</span>
        </div>
        <div id="9016" class="device-message">
            <img src="../images/9016.jpg" />
            <span>9016</span>
        </div>
        <button id="close_popup" type="button">关闭</button>
    </div>
    <div id="fade" class="black_overlay"></div>

    <div class="master">
        <div id="blocklyDiv" style="height: 100%; width: 80%"></div>
        <div class="side">
            <div class="code-view" id='code'>
                <textarea id="output" class="code-text" rows="35" cols="80"></textarea>
            </div>
            <div class="uart-view">
                <textarea id="uart" disabled="disabled"></textarea>
                <div class="uart-input">
                    <input type="text" name="firstname" value="">
                    <button id="uart-send" type="button">发送</button>
                    <button id="uart-send" type="button">暂停</button>
                </div>
            </div>
        </div>
    </div>

    <xml id="toolbox" style="display: none">
        <category name="电机" colour="210">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="math_number"></block>
            <block type="math_arithmetic"></block>
            <block type="text"></block>
            <block type="text_print"></block>
        </category>
        <category name="LED" colour="120">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="传感器" colour="230">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="音乐" colour="20">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="通信" colour="330">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
    </xml>
    <script>
        $(function () {
            $(".code-text").linedtextarea();
        });
    </script>

    <script>
        const { ipcRenderer } = require('electron')
        //生成模块列表区域
        var blocklyDiv = document.getElementById('blocklyDiv');
        var workspace = Blockly.inject(blocklyDiv, {
            media: '../../node_modules/blockly/media/',
            toolbox: document.getElementById('toolbox'),
            zoom: {
                controls: true,
                wheel: true,
                startScale: 1.0,
                maxScale: 3,
                minScale: 0.5,
                scaleSpeed: 1.05
            },
            trashcan: true,
            scrollBar: true
        });

        //调整工作区域大小
        var onresize = function (e) {
            Blockly.svgResize(workspace);
        };
        //注册resize处理函数
        window.addEventListener('resize', onresize);
        Blockly.svgResize(workspace);

        function myUpdateFunction(event) {
            var code = Blockly.Python.workspaceToCode(workspace);
            var output = document.getElementById("output");
            output.value = code;
        }
        workspace.addChangeListener(myUpdateFunction);
    </script>
</body>

</html>