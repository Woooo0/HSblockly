<!DOCTYPE html>
<html style="height:100%">

<head>
    <title>科盟科教</title>
    <script src="../../node_modules/blockly/blockly_compressed.js"></script>
    <script src="../../node_modules/blockly/blocks_compressed.js"></script>
    <script src="../../node_modules/blockly/python_compressed.js"></script>
    <script src="../../node_modules/blockly/msg/en.js"></script>
    <script src="../js/index.js"></script>
    <link rel="stylesheet" href="../css/index.css">
</head>

<body style="height:100%">

    <div class="master">
        <div id="blocklyDiv" style="height: 100%; width: 80%"></div>
        <div class="side">
            <textarea id="output" disabled="disabled"></textarea>
            <textarea id="uart" disabled="disabled"></textarea>
        </div>
    </div>

    <xml id="toolbox" style="display: none">
        <category name="电机" colour="210">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="math_number"></block>
            <block type="math_arithmetic"></block>
            <block type="text"></block>
            <block type="text_print"></block>
        </category>
        <category name="LED" colour="120">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="传感器" colour="230">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="音乐" colour="20">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
        <category name="通信" colour="330">
            <block type="controls_if"></block>
            <block type="controls_if">
                <mutation else="1"></mutation>
            </block>
            <block type="controls_if">
                <mutation elseif="1" else="1"></mutation>
            </block>
        </category>
    </xml>
    <script>
        const { ipcRenderer } = require('electron')
        var uart = document.getElementById("uart");
        ipcRenderer.on('main-process-uart', (event, arg) => {
            uart.value += arg;
            uart.scrollTop = uart.scrollHeight;
        });
        //生成模块列表区域
        var blocklyDiv = document.getElementById('blocklyDiv');
        var workspace = Blockly.inject(blocklyDiv, {
            media: '../../node_modules/blockly/media/',
            toolbox: document.getElementById('toolbox'),
            zoom: {
                controls: true,
                wheel: true,
                startScale: 1.0,
                maxScale: 3,
                minScale: 0.5,
                scaleSpeed: 1.05
            },
            trashcan: true,
            scrollBar: true
        });

        //调整工作区域大小
        var onresize = function (e) {
            Blockly.svgResize(workspace);
        };
        //注册resize处理函数
        window.addEventListener('resize', onresize);
        Blockly.svgResize(workspace);

        function myUpdateFunction(event) {
            var code = Blockly.Python.workspaceToCode(workspace);
            var output = document.getElementById("output");
            output.value = code;
            console.log(code);
            ipcRenderer.send('index.html', code.toString());
        }
        workspace.addChangeListener(myUpdateFunction);
    </script>
</body>

</html>